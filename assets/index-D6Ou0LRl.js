import{r as e,j as a,p as s,G as t,J as l,K as r,P as n,T as i,s as c,Q as o,x as m,B as d,U as h,V as x,F as j,W as p,X as _,Y as f,h as u,Z as y,$ as g}from"./vendor-C-fhNBoB.js";import{s as b}from"./index-8NuCAu1A.js";const w="YYYY-MM-DD",k=({form:o})=>{const[m,d]=e.useState([]),[h,x]=e.useState(!1);e.useEffect((()=>{(async()=>{x(!0);try{const{data:e,error:a}=await b.from("places").select("*").eq("is_active",!0);if(a)throw a;const s=e.map((e=>({value:e.id,label:e.name})));e.length&&d(s)}catch(e){c.error(e.message)}finally{x(!1)}})()}),[]);return a.jsxs(s,{colon:!1,labelAlign:"left",labelCol:{span:4},wrapperCol:{span:10},form:o,name:"create_game",children:[a.jsx(s.Item,{name:"place_id",label:"Площадка",children:a.jsx(t,{options:m,loading:h})}),a.jsx(s.Item,{name:"game_date",label:"Дата проведения",children:a.jsx(l,{placeholder:"Выберите дату",format:w,disabledDate:e=>{const a=r().format(w);return e&&e<r(a,w)}})}),a.jsx(s.Item,{name:"game_time",label:"Время проведения",children:a.jsx(n.RangePicker,{format:"HH:mm"})}),a.jsx(s.Item,{name:"game_price",label:"Цена игры, руб.",children:a.jsx(i,{})}),a.jsx(s.Item,{name:"players_limit",label:"Допустимое число игроков",children:a.jsx(i,{})})]})},C=({handleChangeVisibleModal:e,setChangeGame:t})=>{const[l]=s.useForm();return a.jsx(o,{title:"Создать игру",open:!0,destroyOnClose:!0,maskClosable:!1,onOk:()=>{l.submit(),l.validateFields().then((a=>{a.game_date=r(a.game_date).format("YYYY-MM-DD");const s=a.game_time.map((e=>r(e).format("HH:mm")));a.game_time=s.join(" - "),(async a=>{try{const{data:s,error:l}=await b.from("games").insert([a]).select();if(l)throw l;s&&c.success("Игра добавлена"),t(!0),e(!1)}catch(s){c.error(s.message)}})(a)})).catch((e=>{e.errorFields.forEach((e=>{c.error({content:e.name[0]+": "+e.errors[0],duration:6})}))}))},okText:"Создать",onCancel:()=>e(!1),cancelText:"Закрыть",width:"80vw",style:{top:20},className:"modal-box-custom_with-footer",children:a.jsx(k,{form:l})})},Y="_wrapReserved_177ah_1",v="_cardWrap_177ah_8",S="_editGameBtn_177ah_13",F="_extraSuccess_177ah_19",M="_extraFull_177ah_24",N=()=>{const[s,t]=e.useState(!1),[l,r]=e.useState(!1),[n,i]=e.useState(!1),[o,w]=e.useState([]),k=async()=>{i(!0);try{const{data:e,error:a}=await b.from("customer_games").select("*");if(a)throw a;e.length&&w(e)}catch(e){c.error(e.message)}finally{i(!1)}};e.useEffect((()=>{k()}),[]),e.useEffect((()=>{l&&(k(),r(!1))}),[l]);const N=e=>t(e),D=({total:e,limit:s})=>a.jsxs(a.Fragment,{children:[e===s?a.jsx(y,{status:"success",text:a.jsx("span",{className:M,children:"Нет мест"})}):a.jsx(y,{status:"success",text:a.jsx("span",{className:F,children:"Есть места"})}),a.jsx(g,{className:S})]}),I=({item:e})=>a.jsx(f,{bordered:!0,items:[{key:"1",label:"Дата игры",children:e.game_date},{key:"2",label:"Время игры",children:e.game_time},{key:"3",label:"Адрес площадки",children:e.place_address},{key:"3",label:"Лимит игроков",children:e.players_limit},{key:"3",label:"Проголосовало игроков",children:a.jsxs(j,{justify:"space-between",children:[a.jsx("span",{style:{fontWeight:600},children:e.players_total}),e.players_total>=1&&a.jsx(d,{children:"Список"})]})},{key:"4",label:"Цена",children:e.game_price},{key:"5",label:"Условия записи",children:a.jsxs(j,{justify:"space-between",children:[a.jsx("span",{children:"Оплата сразу"}),a.jsx(u,{style:{fontSize:"20px",cursor:"pointer"},title:"Узнать подробнее"})]})}],layout:"horizontal",column:1});return a.jsxs("div",{className:Y,children:[a.jsxs(m,{size:"large",children:[a.jsx("h3",{children:"Ближайшие игры"}),a.jsx(d,{icon:a.jsx(h,{}),onClick:()=>N(!0),children:"Создать игру"})]}),n?a.jsx(x,{active:!0}):a.jsx(j,{gap:16,wrap:!0,className:v,children:o.length?o.map((e=>a.jsxs(p,{title:e.place_name,extra:a.jsx(D,{total:e.players_total,limit:e.players_limit}),style:{width:550},children:[a.jsx(I,{item:e}),a.jsx(d,{type:"primary",style:{marginTop:"16px",width:"100%"},children:"Записаться"})]},e.id))):a.jsx(_,{description:"Нет предстоящих игр"})}),s&&a.jsx(C,{handleChangeVisibleModal:N,setChangeGame:r})]})};export{N as default};
