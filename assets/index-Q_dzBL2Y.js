import{a as e,u as s,p as a,r,j as l,I as n,T as i,B as o,s as m}from"./vendor-DhVSYgwY.js";import{u as d,s as t,a as c}from"./index-DZUGOxhE.js";const h=()=>{var h;const p=e(),u=s(),{signin:w}=d(),[g]=a.useForm(),[x,j]=r.useState(!1),[_,f]=r.useState(!1),b=(null==(h=u.state)?void 0:h.from)||"/",v=(e,s)=>{const{access_token:a,refresh_token:r}=e;w((()=>{c({name:"access_token",value:a}),c({name:"refresh_token",value:r}),c({name:"user_id",value:s}),p(b,{replace:!0})}))},k={colon:!1,labelAlign:"left",labelCol:{span:8},wrapperCol:{span:14}};return l.jsx("div",{className:"wrap-login",children:l.jsxs("div",{className:"wrap-login__block",children:[l.jsx("div",{className:"wrap-login__block-header",children:l.jsx("h2",{children:x?"Регистрация":"Вход"})}),l.jsx("div",{className:"wrap-login__block-auth",children:l.jsxs(a,{...k,form:g,className:"login-form",name:"auth_form",onFinish:e=>{(async e=>{var s,a,r;f(!0);try{if(x){const{data:r,error:l}=await t.auth.signUp({email:e.email,password:e.password,options:{data:{user_name:e.user_name,user_phone:e.phone}}});if(l)throw l;const{error:n}=await t.from("users").insert({uuid:null==(s=r.user)?void 0:s.id,email:e.email,user_name:e.user_name,user_phone:e.phone});if(n)throw n;console.log("authData",r),r.session&&v(r.session,null==(a=r.user)?void 0:a.id)}else{const{data:s,error:a}=await t.auth.signInWithPassword({email:e.email,password:e.password});if(a)throw a;console.log("data",s),s.session&&v(s.session,null==(r=s.user)?void 0:r.id)}}catch(l){"invalid_credentials"===l.code?m.error("Неправильные email или пароль"):m.error(l.message)}finally{f(!1)}})({email:e.email,password:e.password,user_name:e.user_name,phone:"+7"+e.phone})},children:[l.jsx(a.Item,{name:"email",label:"Почта",rules:[{type:"email",message:"Введите коррректный email"},{required:!0,message:"Введите email"}],children:l.jsx(n,{placeholder:"Email"})}),l.jsx(a.Item,{name:"password",rules:[{required:!0,message:"Введите пароль"}],hasFeedback:!0,label:"Пароль",children:l.jsx(n.Password,{size:"large",placeholder:"Пароль",minLength:6})}),x&&l.jsxs(l.Fragment,{children:[l.jsx(a.Item,{name:"confirm",dependencies:["password"],hasFeedback:!0,label:"Подтвердите пароль",rules:[{required:!0,message:"Подтвердите пароль"},({getFieldValue:e})=>({validator:(s,a)=>a&&e("password")!==a?Promise.reject("Пароли должны совпадать"):Promise.resolve()})],children:l.jsx(n.Password,{placeholder:"Подтвердите пароль",minLength:6})}),l.jsx(a.Item,{name:"user_name",label:"Имя пользователя",rules:[{required:!0,message:"Введите имя пользователя"}],extra:"Имя, которое будет отображаться в списке игроков",children:l.jsx(n,{placeholder:"Имя пользователя"})}),l.jsx(a.Item,{name:"phone",label:"Телефон",children:l.jsx(i,{addonBefore:l.jsx(a.Item,{name:"prefix",noStyle:!0,children:"+7"}),style:{width:"100%"},minLength:10,maxLength:10})})]}),l.jsx(a.Item,{wrapperCol:{...k.wrapperCol},label:" ",children:l.jsx(o,{block:!0,size:"large",type:"primary",htmlType:"submit",loading:_,children:x?"Зарегистрироваться":"Войти"})}),l.jsx(a.Item,{wrapperCol:{...k.wrapperCol},label:" ",children:l.jsx(o,{block:!0,size:"large",type:"primary",onClick:()=>j(!x),children:x?"Уже есть аккаунт? Войти":"Нет аккаунта? Регистрация"})})]})})]})})};export{h as default};
